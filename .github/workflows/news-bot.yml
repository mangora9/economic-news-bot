# .github/workflows/news-bot.yml
name: "ë§ê³ ì˜ ë‰´ìŠ¤ BOT"

on:
  # 1ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰ (í•œêµ­ì‹œê°„ ë§¤ì‹œ ì •ê° = UTC -9ì‹œê°„)
  schedule:
    - cron: "0 15-23,0-14 * * *" # í•œêµ­ì‹œê°„ ë§¤ì‹œ ì •ê° (UTC 15ì‹œ~14ì‹œ)

  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

  # í…ŒìŠ¤íŠ¸ìš©: pushì‹œì—ë„ ì‹¤í–‰ (ë‚˜ì¤‘ì— ì œê±° ê°€ëŠ¥)
  push:
    branches: [main]

# ğŸ†• ê¶Œí•œ ì„¤ì • ì¶”ê°€
permissions:
  contents: write # repository ë‚´ìš© ì“°ê¸° ê¶Œí•œ
  actions: read # actions ì½ê¸° ê¶Œí•œ

jobs:
  send-news:
    runs-on: ubuntu-latest

    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2. Node.js ì„¤ì •
      - name: Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      # 3. ì˜ì¡´ì„± ì„¤ì¹˜
      - name: íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: npm install

      # 4. ê²½ì œë‰´ìŠ¤ ì‹¤í–‰
      - name: ê²½ì œë‰´ìŠ¤ ì „ì†¡
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          NEWS_CATEGORY: economy
        run: npm start

      # 5. ë¶€ë™ì‚°ë‰´ìŠ¤ ì‹¤í–‰
      - name: ë¶€ë™ì‚°ë‰´ìŠ¤ ì „ì†¡
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          NEWS_CATEGORY: realestate
        run: npm start

      # 6. ê¸±ë‰´ìŠ¤ ì‹¤í–‰
      - name: ê¸±ë‰´ìŠ¤ ì „ì†¡
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          NEWS_CATEGORY: geeknews
        run: npm start

      # 7. ë³€ê²½ì‚¬í•­ ì»¤ë°‹ (last_check.json ì—…ë°ì´íŠ¸) - ìˆœì°¨ ì‹¤í–‰ìœ¼ë¡œ ì¶©ëŒ ì—†ìŒ
      - name: ë‰´ìŠ¤ í™•ì¸ ì‹œê°„ ê¸°ë¡ ì €ì¥
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add last_check.json
          if ! git diff --staged --quiet; then
            git commit -m "â° ë‰´ìŠ¤ í™•ì¸ ì™„ë£Œ - $(TZ=Asia/Seoul date +'%Y-%m-%d %H:%M')"
            git push
          else
            echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          fi
