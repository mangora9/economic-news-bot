# .github/workflows/news-bot.yml
name: "망고의 뉴스 BOT"

on:
  # 30분마다 실행 (한국시간 매시 정각, 30분 = UTC -9시간)
  schedule:
    - cron: "0,30 15-23,0-14 * * *" # 한국시간 매 30분마다 (UTC 15시~14시)

  # 수동 실행 가능
  workflow_dispatch:

  # 테스트용: push시에도 실행 (나중에 제거 가능)
  push:
    branches: [main]

jobs:
  send-news:
    runs-on: ubuntu-latest

    steps:
      # 1. 코드 체크아웃
      - name: 코드 가져오기
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2. Node.js 설정
      - name: Node.js 설정
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      # 3. 의존성 설치
      - name: 패키지 설치
        run: npm install

      # 4. 모든 카테고리 뉴스 실행
      - name: 모든 뉴스 전송
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          ECONOMY_CHANNEL_ID: ${{ secrets.ECONOMY_CHANNEL_ID }}
          REALESTATE_CHANNEL_ID: ${{ secrets.REALESTATE_CHANNEL_ID }}
          GEEKNEWS_CHANNEL_ID: ${{ secrets.GEEKNEWS_CHANNEL_ID }}
        run: npm start
